package com.example.Atividades;

import android.app.Application;
import android.content.Intent;
import android.os.Bundle;
import android.support.v7.app.AppCompatActivity;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;

import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

import io.realm.Realm;
import io.realm.RealmConfiguration;
import io.realm.RealmResults;
import io.realm.annotations.Required;

import com.example.Atividades.Evento;
import com.example.tp_pdmm.model.*;
public class ActividadeEvento extends AppCompatActivity {
    Button add, view, update, delete;
    EditText descricao,datainicio,duracao,idevento;
    TextView text;
    Realm realm;

    @Override
    public void onCreate(Bundle savedInstanceState){

        super.onCreate(savedInstanceState);
        Intent intent = getIntent();

        setContentView(R.layout.evento_layout);

        add = (Button)findViewById(R.id.add);

        view = (Button)findViewById(R.id.view);
        update = (Button)findViewById(R.id.update);
        delete = (Button)findViewById(R.id.delete);
        text = (TextView)findViewById(R.id.text);
        descricao = (EditText)findViewById(R.id.descricao);
        datainicio = (EditText)findViewById(R.id.datainicio);
        duracao = (EditText)findViewById(R.id.duracao);
        idevento = (EditText)findViewById(R.id.idevento);

        Realm.init(this);
        realm = Realm.getDefaultInstance();
    }
    public void clickAction(View view){
        switch (view.getId()){
            case R.id.add:  addRecord();
                break;
            case R.id.view: viewRecord();
                break;
            case R.id.update:   updateRecord();
                break;
            case R.id.delete:   deleteRecord();
                break;

        }
    }
    public void addRecord(){
        realm.beginTransaction();

        Number num = realm.where(Evento.class).max("ID");
        int nextId = (num==null) ? 1:num.intValue()+1;
        Evento evento = realm.createObject(Evento.class,nextId);

        evento.setDuracao(Integer.parseInt(duracao.getText().toString()));
        //evento.setDuracao(4);
        evento.setDescricao(descricao.getText().toString());
        //evento.setDescricao("asdas");
        DateFormat dateFormat = new SimpleDateFormat("yyyy/MM/dd");



        //Date date = new Date();
        //evento.setDataInicio(date);

        try {


            Date date = dateFormat.parse(datainicio.getText().toString());
            //  long millies = date.getTime();

            evento.setDataInicio(date);
        }catch (ParseException e){
            e.printStackTrace();
        }

        realm.commitTransaction();
    }
    public void updateRecord(){
        RealmResults<Evento> results = realm.where(Evento.class).equalTo("ID", Integer.parseInt(idevento.getText().toString())).findAll();

        realm.beginTransaction();

        for(Evento evento : results){
            evento.setDescricao(descricao.getText().toString());
            evento.setDuracao(Integer.parseInt(duracao.getText().toString()));
            DateFormat dateFormat = new SimpleDateFormat("yyyy/MM/dd");

            //Date date = new Date();
            //evento.setDataInicio(date);

            try {
                Date date = dateFormat.parse(datainicio.getText().toString());
                //  long millies = date.getTime();

                evento.setDataInicio(date);
            }catch (ParseException e){
                e.printStackTrace();
            }

        }

        realm.commitTransaction();
    }
    public void deleteRecord(){
        RealmResults<Evento> results = realm.where(Evento.class).equalTo("ID", Integer.parseInt(idevento.getText().toString())).findAll();

        realm.beginTransaction();

        results.deleteAllFromRealm();

        realm.commitTransaction();
    }

    public  void viewRecord(){
        RealmResults<Evento> results2 = realm.where(Evento.class).findAll();
        text.setText("");
        for(Evento evento : results2){
            text.append(evento.getID()+" " +evento.getDescricao() + " " + evento.getDataInicio() + " " + evento.getDuracao()+"\n");
        }
        if(results2.isEmpty()){
            text.append("não adicionou");
        }

    }

}
